 ✅ BACKGROUND TOKEN REFRESH - Service started (checks every 15 minutes)
 🔐 Auth state change: INITIAL_SESSION undefined
 No user authenticated for version check
 No user authenticated for version update
 No user authenticated for version update
 Unregistered old SW: ServiceWorkerRegistration
 SW registered:  ServiceWorkerRegistration
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": false,
  "cacheAge": null,
  "cacheSize": 0,
  "timestamp": "2025-10-24T05:42:20.642Z"
}
 🔧 CASE BOOKING DEBUG - Starting department load for country: Singapore
 🔧 CASE BOOKING DEBUG - User role: admin
 🔧 CASE BOOKING DEBUG - Imported getStandardizedDepartments function
 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Singapore
 🔧 UNIFIED SERVICE DEBUG - Normalized country: Singapore
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 5,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:42:20.838Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 25,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:42:20.858Z"
}
 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(3)
 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(3)
 🔧 CASE BOOKING DEBUG - Raw department names from getStandardizedDepartments: Array(3)
 🔧 CASE BOOKING DEBUG - Admin/IT user, using all departments: Array(3)
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 5044,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:42:25.877Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 5343,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:42:26.176Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 5408,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:42:26.241Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 182770,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:45:23.603Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 182785,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:45:23.618Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 188506,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:45:29.339Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 188518,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:45:29.351Z"
}
 🔢 CASE CARD QUANTITIES DEBUG - Loading quantities for case: Object
 📊 Cases loaded: Object
 🔍 CaseCard Debug - Setting quantities: Object
 🔢 CASE CARD QUANTITIES DEBUG - Quantities loaded: Object
 🔢 CASE CARD QUANTITIES DEBUG - Quantities mapped: Object
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 292419,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:47:13.252Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 292432,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:47:13.265Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 294206,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:47:15.039Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 294218,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:47:15.051Z"
}
 ✅ Admin panel access granted for admin role
 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 294417,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:47:15.250Z"
}
 🔄 BACKGROUND TOKEN REFRESH - Checking token status...
 📧 ADMIN CONFIG DEBUG - Found global admin email config Object
 🔄 BACKGROUND TOKEN REFRESH - Token expiring soon, refreshing proactively...
login.microsoftonline.com/d213fe2b-9fcd-42cf-90a4-8ea84de3103e/oauth2/v2.0/token:1   Failed to load resource: the server responded with a status of 400 ()
  ❌ BACKGROUND TOKEN REFRESH - Failed to refresh token
(anonymous) @ main.1d3c5d2d.js:2
 Service Worker loaded successfully
 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 74618,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:37.006Z"
}
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 74628,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:37.016Z"
}
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 75314,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:37.702Z"
}
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 75356,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:37.744Z"
}
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Hong Kong
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Hong Kong
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Indonesia
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Indonesia
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Malaysia
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Malaysia
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(1)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(1)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Philippines
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Philippines
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(1)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(1)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Singapore
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Singapore
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(3)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(3)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Thailand
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Thailand
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - getStandardizedDepartments called with country: Vietnam
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Normalized country: Vietnam
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Raw departments from getCodeTableDepartments: Array(5)
main.1d3c5d2d.js:2 🔧 UNIFIED SERVICE DEBUG - Final sorted departments: Array(5)
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 79854,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:42.242Z"
}
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 79862,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:42.250Z"
}
main.1d3c5d2d.js:2 🔢 CASE CARD QUANTITIES DEBUG - Loading quantities for case: Object
main.1d3c5d2d.js:2 📊 Cases loaded: Object
main.1d3c5d2d.js:2 🔢 CASE CARD QUANTITIES DEBUG - Quantities loaded: Object
main.1d3c5d2d.js:2 🔢 CASE CARD QUANTITIES DEBUG - Quantities mapped: Object
main.1d3c5d2d.js:2 🔍 CaseCard Debug - Setting quantities: Object
main.1d3c5d2d.js:2 🔄 SALES APPROVED DEBUG - Function called: Object
main.1d3c5d2d.js:2 ⚡ SALES APPROVED DEBUG - Starting status update...
main.1d3c5d2d.js:2 📝 SALES APPROVED DEBUG - Details prepared: Object
main.1d3c5d2d.js:2 🔧 STATUS DETAILS DEBUG - Initial parameters: Object
main.1d3c5d2d.js:2 🔧 JSON PARSING DEBUG - Successfully parsed details: Object
main.1d3c5d2d.js:2 📎 ATTACHMENT DEBUG - Status history attachments: Object
main.1d3c5d2d.js:2 🔧 REALTIME QUERY DEBUG - Case data update: Object
main.1d3c5d2d.js:2 ✅ REALTIME QUERY DEBUG - Case data update successful
main.1d3c5d2d.js:2 📧 REALTIME EMAIL DEBUG - Triggering email notifications for status update: Object
main.1d3c5d2d.js:2 📧 REALTIME EMAIL DEBUG - Converted case data for email processing: Object
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Function Entry: Object
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Using centralized admin email service: Object
main.1d3c5d2d.js:2 ✅ SALES APPROVED DEBUG - Status update completed: Object
main.1d3c5d2d.js:2 🎉 SALES APPROVED DEBUG - Complete function finished: Object
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 94831,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:57.219Z"
}
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 94832,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:57.220Z"
}
main.1d3c5d2d.js:2 📧 ADMIN CONFIG DEBUG - Found global admin email config Object
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Admin email config check: Object
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Fetching notification rule: Object
main.1d3c5d2d.js:2 ✅ Admin panel access granted for admin role
main.1d3c5d2d.js:2 🔍 CRITICAL PERMISSION CHECK: {
  "roleId": "admin",
  "actionId": "manage-doctors",
  "userId": "system",
  "cacheExists": true,
  "cacheAge": 94976,
  "cacheSize": 303,
  "timestamp": "2025-10-24T05:58:57.364Z"
}
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Available rules for country: Object
main.1d3c5d2d.js:2 📧 EMAIL PROCESSOR DEBUG - Notification rule query result: Object
main.1d3c5d2d.js:2 ✅ EMAIL PROCESSOR DEBUG - Admin email system ready: Object
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Notification rule details: Object
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User arthur.pei@transmedicgroup.com included by role: operations
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: arthur.pei@transmedicgroup.com (Arthur Pei Jia Le)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User jasmine.mai@transmedicgroup.com included by role: operations
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: jasmine.mai@transmedicgroup.com (Jasmine Mai)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User jason.ang@transmedicgroup.com included by role: driver
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: jason.ang@transmedicgroup.com (Jason Ang)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User jiasheng.wong@transmedicgroup.com included by role: operations
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: jiasheng.wong@transmedicgroup.com (Jiasheng Wong)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User randy.cai@transmedicgroup.com included by role: operations
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: randy.cai@transmedicgroup.com (Randy Cai)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - User sophia.tay@transmedicgroup.com included by role: operations-manager
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Added recipient: sophia.tay@transmedicgroup.com (Sophia Tay)
main.1d3c5d2d.js:2 📧 EMAIL DEBUG - Final recipient analysis: Object
main.1d3c5d2d.js:2 ✅ EMAIL DEBUG - Found 7 recipients for Sales Approved notification: Array(7)
main.1d3c5d2d.js:2 🔍 TEMPLATE DEBUG - Database template content: Object
main.1d3c5d2d.js:2 🔍 TEMPLATE DEBUG - Final template after variable replacement: Object
main.1d3c5d2d.js:2 🔍 E2E DEBUG - Admin email notification attempt: Object
main.1d3c5d2d.js:2 📧 ADMIN CONFIG DEBUG - Found global admin email config Object
main.1d3c5d2d.js:2 🔄 TOKEN REFRESH - Admin token expired, attempting refresh...
login.microsoftonline.com/d213fe2b-9fcd-42cf-90a4-8ea84de3103e/oauth2/v2.0/token:1   Failed to load resource: the server responded with a status of 400 ()
main.1d3c5d2d.js:2  ❌ TOKEN REFRESH - Failed to refresh admin email token
sendEmail @ main.1d3c5d2d.js:2
main.1d3c5d2d.js:2 🔍 E2E DEBUG - Admin Email Service Response: Object
main.1d3c5d2d.js:2  📧 Failed to send admin email notification for case TMC-Singapore-2025-101: Object
o @ main.1d3c5d2d.js:2
main.1d3c5d2d.js:2 ✅ REALTIME EMAIL DEBUG - Email notifications processed successfully: Object
sw.js?v=1.3.4-1761284536178:120 🔄 Serving UNCACHED fresh JS/CSS from network: https://tmcasebooking.vercel.app/static/css/main.1d8c174b.css
sw.js?v=1.3.4-1761284536178:120 🔄 Serving UNCACHED fresh JS/CSS from network: https://tmcasebooking.vercel.app/manifest.json
main.1d3c5d2d.js:2 🔄 BACKGROUND TOKEN REFRESH - Checking token status...
main.1d3c5d2d.js:2 📧 ADMIN CONFIG DEBUG - Found global admin email config Object
main.1d3c5d2d.js:2 🔄 BACKGROUND TOKEN REFRESH - Token expiring soon, refreshing proactively...
login.microsoftonline.com/d213fe2b-9fcd-42cf-90a4-8ea84de3103e/oauth2/v2.0/token:1   Failed to load resource: the server responded with a status of 400 ()
main.1d3c5d2d.js:2  ❌ BACKGROUND TOKEN REFRESH - Failed to refresh token
(anonymous) @ main.1d3c5d2d.js:2
